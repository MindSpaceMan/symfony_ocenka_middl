{% extends 'base.html.twig' %}

{% block title %}Заказать услугу оценки{% endblock %}

{% block body %}
    <style>
        .page{min-height:70vh;padding:20px}
        .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;
            background:#fff;border:1px solid #e7e7e7;border-radius:14px;padding:12px 14px;
            box-shadow:0 10px 30px rgba(0,0,0,.06);max-width:820px;margin:0 auto 16px}
        .brand{display:flex;flex-direction:column;line-height:1.2}
        .brand b{font-size:14px}
        .brand small{color:#666;font-size:12px}
        .btn-ghost{padding:8px 12px;border-radius:10px;border:1px solid #d9d9d9;background:#fff;cursor:pointer}
        .btn-ghost:hover{filter:brightness(.98)}
        .wrap{display:flex;align-items:flex-start;justify-content:center}
        .card{width:100%;max-width:820px;background:#fff;border:1px solid #e7e7e7;border-radius:14px;
            box-shadow:0 10px 30px rgba(0,0,0,.06);padding:18px}
        .title{margin:0 0 6px;font-size:22px}
        .sub{margin:0 0 18px;color:#666;font-size:14px}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
        @media (max-width: 720px){.grid{grid-template-columns:1fr}}
        .row{margin:0}
        .label{display:block;margin:0 0 6px;font-size:13px;color:#333}
        .input, select{width:100%;padding:10px 12px;border:1px solid #d9d9d9;border-radius:10px;outline:none;background:#fff}
        .input:focus, select:focus{border-color:#7aa7ff;box-shadow:0 0 0 4px rgba(122,167,255,.15)}
        .price{display:flex;align-items:center;gap:10px}
        .price input{flex:1}
        .rub{color:#666;font-size:13px;white-space:nowrap}
        .actions{margin-top:14px;display:flex;gap:10px;align-items:center;justify-content:flex-end}
        .btn{padding:10px 14px;border-radius:10px;border:0;background:#2f6feb;color:#fff;font-weight:600;cursor:pointer}
        .btn:hover{filter:brightness(.97)}
        .flash{padding:10px 12px;border-radius:10px;margin:0 0 12px}
        .flash--success{background:#effdf5;border:1px solid #bdebcf;color:#155f3a}
    </style>

    <div class="page">
        <div class="topbar">
            <div class="brand">
                <b>Заказ услуги оценки</b>
                <small>Пользователь: {{ app.user ? app.user.userIdentifier : '—' }}</small>
            </div>

            {# logout_path() сам построит правильный URL для выхода #}
            <a class="btn-ghost" href="{{ logout_path() }}">Выйти</a>
        </div>

        <div class="wrap">
            <div class="card">
                {% for msg in app.flashes('success') %}
                    <div class="flash flash--success">{{ msg }}</div>
                {% endfor %}

                <h1 class="title">Заказать услугу</h1>
                <p class="sub">Выберите услугу, укажите почту и подтвердите заказ.</p>

                {{ form_start(form) }}

                <div class="grid">
                    <div class="row">
                        <label class="label" for="{{ form.service.vars.id }}">Услуга</label>
                        {{ form_widget(form.service) }}
                        {{ form_errors(form.service) }}
                    </div>

                    <div class="row">
                        <label class="label" for="{{ form.email.vars.id }}">Электронная почта</label>
                        {{ form_widget(form.email, { attr: { class: 'input' } }) }}
                        {{ form_errors(form.email) }}
                    </div>

                    <div class="row">
                        <label class="label" for="price-view">Стоимость</label>
                        <div class="price">
                            <input id="price-view" class="input" type="text" value="" readonly>
                            <span class="rub">руб.</span>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button type="submit" class="btn">Подтвердить</button>
                </div>

                {{ form_end(form) }}
            </div>
        </div>
    </div>

    <script>
        function initPriceWatcher() {
            const select = document.getElementById('{{ form.service.vars.id }}');
            const priceView = document.getElementById('price-view');
            if (!select || !priceView) return;

            const updatePrice = () => {
                const opt = select.selectedOptions?.[0];
                const price = opt?.getAttribute('data-price');
                priceView.value = price ? price : '';
            };

            select.removeEventListener('change', updatePrice); // на всякий
            select.addEventListener('change', updatePrice);
            updatePrice();
        }

        document.addEventListener('DOMContentLoaded', initPriceWatcher);
        document.addEventListener('turbo:load', initPriceWatcher);
        document.addEventListener('turbo:render', initPriceWatcher);
    </script>
{% endblock %}
